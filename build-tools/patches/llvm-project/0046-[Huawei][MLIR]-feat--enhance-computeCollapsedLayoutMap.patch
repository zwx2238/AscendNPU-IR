diff --git a/mlir/lib/Dialect/MemRef/IR/MemRefOps.cpp b/mlir/lib/Dialect/MemRef/IR/MemRefOps.cpp
index 19c265ce612a..4f75ab570636 100644
--- a/mlir/lib/Dialect/MemRef/IR/MemRefOps.cpp
+++ b/mlir/lib/Dialect/MemRef/IR/MemRefOps.cpp
@@ -2648,8 +2648,8 @@ computeCollapsedLayoutMap(MemRefType srcType,
     auto stride = SaturatedInteger::wrap(resultStrides[resultStrideIndex--]);
     for (int64_t idx : llvm::reverse(trailingReassocs)) {
 #ifdef BSPUB_DAVINCI_BISHENGIR
-      if (idx < startIdx || idx > endIdx) {
-        // skip the leading one dim
+      if (idx < startIdx || idx > endIdx || startIdx == endIdx) {
+        // skip the leading or trailing one dim, also skip unique non-one dim
         continue;
       }
 #endif
